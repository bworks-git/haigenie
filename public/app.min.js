var haigenie=angular.module('haigenieFront', ['LocalStorageModule','ngRoute','cfp.loadingBar']);haigenie.run(function($rootScope,$http, $location,Auth){$rootScope.location=$location; $rootScope.logout=function(){Auth.logout(); $rootScope.loggedIn="no"; window.location.reload();}haigenie.controller('AuthController',['$scope','$rootScope','$http','Auth','$location','cfpLoadingBar',function($scope,$rootScope,$http,Auth,$location,cfpLoadingBar){$scope.register=function(){if($scope.password !=$scope.confirmPassword){alert('Passwords does not match');}else{data={name:$scope.name , email: $scope.email , password : $scope.password};$http.post('/api/user/register',data).success(function(data){if(data.message=="error"){alert("Email already exists");}else{alert("success");}});}}$scope.doLogin=function(){cfpLoadingBar.start();Auth.login($scope.email,$scope.password).success(function(data){if(data[0].message=="success"){cfpLoadingBar.complete();alert('success ');$rootScope.loggedIn="yes";return true;}else{alert('invalide credentials');cfpLoadingBar.complete();}});}}]);haigenie.controller('HeaderController',['$scope','$rootScope','$http','Cart',function($scope,$rootScope,$http,Cart){$rootScope.loggedIn="no";$http.get('/api/user/me').success(function(data){if ( data.role=="customer"){$rootScope.loggedIn="yes";}else if(data.role=="admin"){$rootScope.loggedIn="yes";}else{$rootScope.loggedIn="no";}});if(Cart.getCart()!=null)$rootScope.cart_count=Cart.getCart().length;else $rootScope.cart_count=0;var items=Cart.getCart();var total=0;if(items==null){$rootScope.subtotal=0;}else{for(var i=0;i<items.length;i++){total+=items[i].subtotal;}$rootScope.subtotal=total;if(total>=600) $rootScope.shipping=0;else $rootScope.shipping=50;$rootScope.grand_total=$rootScope.subtotal+$rootScope.shipping;}$scope.updateSubtotal=function(){var items=Cart.getCart();var total=0;if(items==null){$rootScope.subtotal=0;}else{for(var i=0;i<items.length;i++){total+=items[i].subtotal;}$rootScope.subtotal=total;if(total>=600) $rootScope.shipping=0;else $rootScope.shipping=50;$rootScope.grand_total=$rootScope.subtotal+$rootScope.shipping;}}$scope.incrementItem=function(variant_id,tax,price){Cart.incrementItem(variant_id,tax,price);$rootScope.cart_items=Cart.getCart();$scope.updateSubtotal();}$scope.decrementItem=function(variant_id,tax,price){Cart.decrementItem(variant_id,tax,price);$rootScope.cart_items=Cart.getCart();$scope.updateSubtotal();}$scope.removeItem=function(index){Cart.removeItem(index);$rootScope.cart_items=Cart.getCart();$scope.updateSubtotal();$rootScope.cart_count=Cart.getCart().length;}}]);haigenie.controller('HomeController',['$scope','$rootScope','$http','Auth','Cart','$location','cfpLoadingBar','$window',function($scope,$rootScope,$http,Auth,Cart,$location,cfpLoadingBar,$window){cfpLoadingBar.start();$scope.Math=$window.Math;$rootScope.cart_items=Cart.getCart();$http.get('/api/category').success(function(data){$scope.categories=data ;$http.get('/api/product/category/'+data[0].name).success(function(data){$scope.products=data ;cfpLoadingBar.complete();});});$scope.cart_count=0;$scope.loadData=function(category){cfpLoadingBar.start();$http.get('/api/product/category/'+category).success(function(data){$scope.products=data ;cfpLoadingBar.complete();});}$scope.add2cart=function(product_id,name,qty,img,selected_variant,tax){$http.get("/api/product/variant/"+product_id+"/"+selected_variant).success(function(data){var subtotal=$scope.Math.round((parseInt(tax)/100)*parseInt(data.price)*qty)+(parseInt(data.price)*qty) ;Cart.setCart(product_id,name,selected_variant,img,data.quantity,data.unit,qty,data.price,tax,subtotal);$rootScope.cart_count=Cart.getCart().length;$rootScope.cart_items=Cart.getCart();var items=Cart.getCart();var total=0;if(items==null){$rootScope.subtotal=0;}else{for(var i=0;i<items.length;i++){total+=items[i].subtotal;}$rootScope.subtotal=total;if(total>=600) $rootScope.shipping=0;else $rootScope.shipping=50;$rootScope.grand_total=$rootScope.subtotal+$rootScope.shipping;}});}}]);haigenie.controller('OrderController',['$scope','$rootScope','$http','Cart',function($scope,$rootScope,$http,Cart){$http.get('/api/user/details').success(function(data){$scope.email=data.email;$scope.name=data.name;$scope.mobile=data.mobile;$scope.birthdate=data.birthdate;$scope.gender=data.gender;$scope.alternate_mobile=data.alternate_mobile;$scope.doorNo=data.doorNo; $scope.street1=data.street1; $scope.street2=data.street2; $scope.area=data.area; $scope.landmark=data.landmark;$scope.city=data.city; $scope.state=data.state; $scope.country=data.country; $scope.pincode=data.pincode;});$scope.postOrder=function(){var data={email:$scope.email,name: $scope.name,mobile : $scope.mobile,city:$scope.city,state:$scope.state,country:$scope.country,pincode:$scope.pincode,landmark:$scope.landmark,area:$scope.area,doorNo:$scope.doorNo,street1:$scope.street1,street2:$scope.street2,subtotal:$rootScope.subtotal,items:Cart.getCart()}$http.post('/api/order/',data).success(function(data){if(data.message=="error"){alert("you need to login before placing order");}else if(data.message=="failed"){alert("something went wrong");}else{alert("success");Cart.removeCart();$rootScope.cart_count=0;$rootScope.cart_items=Cart.getCart();$rootScope.subtotal=0;$rootScope.shipping=0;$rootScope.grand_total=0;}});}}]);haigenie.controller('UserProfileController',['$scope','$rootScope','$http','Cart',function($scope,$rootScope,$http,Cart){$http.get('/api/user/details').success(function(data){$scope.email=data.email;$scope.email1=data.email;$scope.firstName=data.firstName;$scope.lastName=data.lastName;$scope.mobile=data.mobile;$scope.birthdate=data.birthdate;$scope.gender=data.gender;$scope.alternate_mobile=data.alternate_mobile;$scope.doorno=data.doorNo; $scope.street1=data.street1; $scope.street2=data.street2; $scope.area=data.area; $scope.landmark=data.landmark;$scope.city=data.city; $scope.state=data.state; $scope.country=data.country; $scope.pincode=data.pincode;});$scope.updateInfo=function(){var data={email:$scope.email, firstName:$scope.firstName , lastName:$scope.lastName, mobile:$scope.mobile, alternate_mobile : $scope.alternate_mobile, gender:$scope.gender, birthdate:$scope.birthdate}$http.post('/api/user/details',data).success(function(data){alert(data);});}$scope.updateAddress=function(){var data={doorno:$scope.doorno, street1:$scope.street1 , street2:$scope.street2, area:$scope.area, landmark : $scope.landmark, city:$scope.city, state:$scope.state, country:$scope.country, pincode:$scope.pincode}$http.post('/api/user/address',data).success(function(data){alert(data);});}}]);